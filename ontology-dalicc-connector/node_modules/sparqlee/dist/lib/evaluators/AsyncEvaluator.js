"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AsyncEvaluator = void 0;
const Transformation_1 = require("../Transformation");
const RecursiveExpressionEvaluator_1 = require("./RecursiveExpressionEvaluator");
class AsyncEvaluator {
    constructor(algExpr, config = {}) {
        this.algExpr = algExpr;
        this.config = config;
        const context = {
            now: config.now || new Date(Date.now()),
            bnode: config.bnode || undefined,
            baseIRI: config.baseIRI || undefined,
            exists: config.exists,
            aggregate: config.aggregate,
        };
        const extensionFunctionCreator = 
        // eslint-disable-next-line unicorn/no-useless-undefined
        config.extensionFunctionCreator || (() => undefined);
        this.expr = (0, Transformation_1.transformAlgebra)(algExpr, { type: 'async', creator: extensionFunctionCreator });
        this.evaluator = new RecursiveExpressionEvaluator_1.AsyncRecursiveEvaluator(context);
    }
    async evaluate(mapping) {
        const result = await this.evaluator.evaluate(this.expr, mapping);
        return result.toRDF();
    }
    async evaluateAsEBV(mapping) {
        const result = await this.evaluator.evaluate(this.expr, mapping);
        return result.coerceEBV();
    }
    async evaluateAsInternal(mapping) {
        const result = await this.evaluator.evaluate(this.expr, mapping);
        return result;
    }
}
exports.AsyncEvaluator = AsyncEvaluator;
//# sourceMappingURL=AsyncEvaluator.js.map