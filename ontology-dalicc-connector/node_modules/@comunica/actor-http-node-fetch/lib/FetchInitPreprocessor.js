"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FetchInitPreprocessor = void 0;
const http_1 = require("http");
const https_1 = require("https");
const bus_http_1 = require("@comunica/bus-http");
/**
 * Overrides the HTTP agent to perform better in Node.js.
 */
class FetchInitPreprocessor {
    constructor(agentOptions) {
        const httpAgent = new http_1.Agent(agentOptions);
        const httpsAgent = new https_1.Agent(agentOptions);
        this.agent = (_parsedURL) => _parsedURL.protocol === 'http:' ? httpAgent : httpsAgent;
    }
    handle(init) {
        // Convert body Web stream to Node stream, as node-fetch does not support Web streams
        if (init.body && 'getReader' in init.body) {
            init.body = bus_http_1.ActorHttp.toNodeReadable(init.body);
        }
        return Object.assign(Object.assign({}, init), { agent: this.agent });
    }
}
exports.FetchInitPreprocessor = FetchInitPreprocessor;
//# sourceMappingURL=FetchInitPreprocessor.js.map